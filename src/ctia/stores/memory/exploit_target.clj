(ns ctia.stores.memory.exploit-target
  (:require [ctia.schemas.exploit-target
             :refer [NewExploitTarget StoredExploitTarget realize-exploit-target]]
            [ctia.store :refer [IExploitTargetStore]]
            [ctia.stores.memory.common :as mc]))

(def swap-exploit-target (mc/make-swap-fn realize-exploit-target))

(mc/def-create-handler handle-create-exploit-target
  StoredExploitTarget NewExploitTarget swap-exploit-target (mc/random-id "exploit-target"))

(mc/def-read-handler handle-read-exploit-target StoredExploitTarget)

(mc/def-delete-handler handle-delete-exploit-target StoredExploitTarget)

(mc/def-update-handler handle-update-exploit-target
  StoredExploitTarget NewExploitTarget swap-exploit-target)

(defrecord ExploitTargetStore [state]
  IExploitTargetStore
  (read-exploit-target [_ id]
    (handle-read-exploit-target state id))
  (create-exploit-target [_ login new-exploit-target]
    (handle-create-exploit-target state login new-exploit-target))
  (update-exploit-target [_ id login new-exploit-target]
    (handle-update-exploit-target state id login new-exploit-target))
  (delete-exploit-target [_ id]
    (handle-delete-exploit-target state id))
  (list-exploit-targets [_ filter-map]))
